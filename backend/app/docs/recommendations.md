# Рекомендательная система

## Обзор

Рекомендательная система использует гибридный подход, сочетающий контентную и коллаборативную фильтрацию для предоставления персонализированных рекомендаций книг пользователям.

## Принцип работы

### 1. Гибридный подход

Система объединяет два метода рекомендаций:

- **Контентная фильтрация (вес: 0.4)**
  - Анализирует предпочтения пользователя по авторам, категориям и тегам
  - Учитывает оценки пользователя для определения его интересов
  - Рекомендует книги с похожими характеристиками

- **Коллаборативная фильтрация (вес: 0.6)**
  - Находит пользователей с похожими вкусами
  - Анализирует их оценки книг
  - Рекомендует книги, которые понравились похожим пользователям

### 2. Процесс формирования рекомендаций

1. **Анализ предпочтений пользователя**
   - Сбор информации о любимых авторах
   - Определение предпочитаемых категорий
   - Выявление интересующих тегов

2. **Поиск похожих пользователей**
   - Сравнение оценок книг
   - Выявление пользователей с похожими вкусами
   - Учет минимального рейтинга для фильтрации

3. **Комбинирование результатов**
   - Нормализация оценок от обоих методов
   - Взвешивание результатов
   - Сортировка по итоговой оценке

## API Endpoints

### Получение рекомендаций

```http
GET /recommendations/
```

Параметры:
- `limit` (int, опционально): максимальное количество рекомендаций (по умолчанию 10)
- `min_rating` (float, опционально): минимальный рейтинг для учета (по умолчанию 3.0)

Ответ:
```json
[
  {
    "id": 1,
    "title": "Название книги",
    "description": "Описание книги",
    "year": 2023,
    "publisher": "Издательство",
    "isbn": "978-3-16-148410-0",
    "rating": 4.5,
    "authors": [...],
    "categories": [...],
    "tags": [...]
  }
]
```

## Технические детали

### SQL Запросы

1. **Получение предпочтений пользователя**
```sql
WITH user_preferences AS (
  SELECT
    a.id as author_id,
    c.id as category_id,
    t.id as tag_id,
    AVG(r.rating) as avg_rating
  FROM ratings r
  JOIN books b ON r.book_id = b.id
  LEFT JOIN book_authors ba ON b.id = ba.book_id
  LEFT JOIN authors a ON ba.author_id = a.id
  LEFT JOIN book_categories bc ON b.id = bc.book_id
  LEFT JOIN categories c ON bc.category_id = c.id
  LEFT JOIN book_tags bt ON b.id = bt.book_id
  LEFT JOIN tags t ON bt.tag_id = t.id
  WHERE r.user_id = :user_id
  GROUP BY a.id, c.id, t.id
)
```

2. **Поиск похожих пользователей**
```sql
WITH similar_users AS (
  SELECT
    r2.user_id,
    COUNT(*) as common_ratings,
    AVG(ABS(r1.rating - r2.rating)) as rating_diff
  FROM ratings r1
  JOIN ratings r2 ON r1.book_id = r2.book_id
  WHERE r1.user_id = :user_id
  AND r2.user_id != :user_id
  GROUP BY r2.user_id
  HAVING COUNT(*) >= 3
  ORDER BY rating_diff ASC
  LIMIT 10
)
```

## Ограничения и особенности

1. **Минимальные требования**
   - Для коллаборативной фильтрации требуется минимум 3 общие оценки с другими пользователями
   - Минимальный рейтинг для учета в рекомендациях: 3.0

2. **Производительность**
   - Используются индексы для оптимизации запросов
   - Результаты кэшируются для часто запрашиваемых рекомендаций

3. **Масштабируемость**
   - Система может быть расширена для учета дополнительных факторов
   - Возможность настройки весов для разных методов фильтрации

## Тестирование

Для тестирования рекомендательной системы можно использовать следующие curl-запросы:

```bash
# Получение рекомендаций
curl -X GET "http://localhost:8000/recommendations/?limit=5&min_rating=3.5" \
     -H "Authorization: Bearer YOUR_TOKEN"
```

## Планы по улучшению

1. **Добавление новых факторов**
   - Учет времени чтения
   - Анализ последовательности чтения
   - Учет популярности книг

2. **Оптимизация алгоритмов**
   - Внедрение машинного обучения
   - Улучшение точности рекомендаций
   - Оптимизация производительности

3. **Расширение функциональности**
   - Рекомендации по авторам
   - Рекомендации по категориям
   - Персонализированные подборки
